<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Full stack expense tracker</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://sdk.cashfree.com/js/v3/cashfree.js"></script>
  </head>
  <body>
    <div id="main">
      <header><h2>Expense Tracker</h2></header>
      <button style="margin-left: 60%" id="pay-btn">Buy Premium</button>
      <div id="expense-form-container">
        <form id="expense-form" onsubmit="handleExpenseForm(event)">
          <label for="amount">Choose Expense Amount:</label>
          <br />
          <input type="number" id="amount" name="amount" min="10" required />
          <br />
          <br />
          <label for="description">Choose Description:</label>
          <br />
          <textarea
            name="description"
            id="description"
            rows="5"
            cols="30"
            required
          ></textarea>
          <br /><br />
          <!-- <label for="category">Choose a Category:</label>
          <select name="category" id="category">
            <option value="food">food</option>
            <option value="electricity">electricity</option>
            <option value="bills">Bills</option>
            <option value="medicine">Medicine</option>
          </select> -->
          <br />
          <br />
          <button type="submit">Add Expense</button>
        </form>

        <div id="leaderboard-section">
          <p id="premium-user-message"></p>
          <h3>Leaderboard</h3>
          <button id="leaderboard-btn" onclick="showLeaderBoard()">
            Show Leaderboard
          </button>
          <ul id="leaderboard-list"></ul>
        </div>
      </div>
      <br />
      <div id="expenses-section">
        <h2>Expenses</h2>
        <ul id="expense-list"></ul>
      </div>
      <div id="filtered-expenses-container">
        <div>
          <label for="expensesfilter">Select expenses filter:</label
          ><select name="expensesfilter" id="expensesfilter">
            <option value="daily">daily</option>
            <option value="weekly">weekly</option>
            <option value="monthly">monthly</option>
          </select>
        </div>
        <h3>Day to Day Expenses</h3>
        <table id="expense-table">
          <tr id="expense-headings">
            <th>amount</th>
            <th>Description</th>
            <th>Category</th>
          </tr>
        </table>
        <div id="paginated-btns-container">
          <label for="rows-per-page-selector">Rows Per Page</label>
          <select name="rowsperpageselector" id="rows-per-page-selector" onchange="changeRowsPerPage(event)">
            <option value="2">2</option>
            <option value="5">5</option>
            <option value="10">10</option>
          </select>
          <button
            id="prev-btn"
            class="paginated-btn"
            onclick="loadPrevNItems()"
          >
            prev
          </button>
          <button
            id="next-btn"
            class="paginated-btn"
            onclick="loadNextNItems()"
          >
            next
          </button>
        </div>
        <br />
        <button id="download-expense-btn" onclick="downloadExpense()">
          Download Expenses
        </button>
      </div>
    </div>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.11.0/axios.min.js"
      integrity="sha512-h9644v03pHqrIHThkvXhB2PJ8zf5E9IyVnrSfZg8Yj8k4RsO4zldcQc4Bi9iVLUCCsqNY0b4WXVV4UB+wbWENA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        let totalItemsCount = null;
        const EXPENSE_BASE_URL = "http://localhost:3000/expenses";
        const token = localStorage.getItem("token");

        axios
          .get(`${EXPENSE_BASE_URL}`, {
            headers: { Authorization: `${token}` },
          })
          .then((res) => {
            const { expenses, isPremiumUser } = res.data;
            totalItemsCount = expenses.length;
            setTotalItemsCount(totalItemsCount);
            loadNextNItems();
            if (isPremiumUser) {
              enablePremiumUserFeatures();
            }
            expenses.forEach((expense) => {
              const { id, amount, description, category } = expense;
              createLi(id, amount, description, category);
            });
          })
          .catch((err) => {
            console.log(err);
            if (err.response.data.isPremiumUser) {
              enablePremiumUserFeatures();
            }
          });
      });
    </script>
    <script src="./cashfree.js"></script>
    <script src="./script.js"></script>
  </body>
</html>
